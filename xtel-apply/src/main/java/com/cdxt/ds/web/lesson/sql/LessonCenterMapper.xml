<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cdxt.ds.web.lesson.dao.LessonCenterDao">

<!-- 查询已报名信息课程 -->
<select id="getSignupListbyuserId" parameterType="int" resultType="int">

select COURSEID from XTEL_SignupList WHERE USERID=#{userID}
</select>



<!-- 通过登录名查询XTEL_COURSEINFO -->
<select id="listAllLesson"  resultType="map" parameterType="java.util.List">
	   	select  a.COURSEID,a.LECTUREID,a.NAME,a.STATUS,a.TOTALCLASS,a.PRICE,a.TYPE,
 	a.SOLD,a.PASS,a.LASTCLASSTIME,a.REVIEWERID,x.USERNAME,x.USERID 
 	from XTEL_COURSEINFO a inner join XTEL_USERINFOTABLE x on a.LECTUREID=x.USERID
 	where  a.STATUS=2 and a.COURSEID not in 
 	  <foreach collection="list" index="index" item="item" open="(" separator="," close=")">  
            #{item}  
        </foreach>
</select>

<!-- 根据id查看课程的信息 -->
<select id="getCourseInfoByid"  resultType="map" parameterType="int">
<!--  select a.roomid,a.roomname,a.capacity,a.roomstatus,a.lockstatus
  from ROOMINFOTABLE a 
 	order by a.roomid-->
 	select  a.COURSEID,a.LECTUREID,a.NAME,a.STATUS,a.TOTALCLASS,a.PRICE,a.TYPE,
 	a.SOLD,a.PASS,a.LASTCLASSTIME,a.REVIEWERID,a.BRIEF,a.NUMBEROFEXPECTED,x.USERNAME,x.USERID 
 	from XTEL_COURSEINFO a inner join XTEL_USERINFOTABLE x on a.LECTUREID=x.USERID 
 	where a.COURSEID=#{cpurseID}
</select>
<!-- 新增培训报名信息 -->
<insert id="insertSignup" parameterType="map">
insert into  XTEL_SignupList(ID,USERID,COURSEID,TIME) 
VALUES(SIGNUP_SQ.NEXTVAL,#{userid},#{CpurseID},#{time})
</insert>
<!-- 修改课程表的出售数量 -->
<update id="updateSignupSold"  parameterType="map">

update XTEL_COURSEINFO set SOLD=SOLD+1 where COURSEID=#{CpurseID}

</update>

<!-- 查询课程信息单一记录 -->
<select id="getCourseInfobyCpurseID" parameterType="int" resultType="CourseInfo">

select a.STATUS "status" from  XTEL_COURSEINFO a where a.COURSEID=#{cpurseID}
</select>

<!-- 删除课程信息记录 -->
<delete id="deleteClassInfo" parameterType="int">

delete from  XTEL_COURSEINFO a where a.COURSEID=#{cpurseID}

</delete>

<!-- 通过登录名查询XTEL_COURSEINFO -->
<select id="listMyLessonPage"  resultType="map" parameterType="int">
	   	select  a.COURSEID,a.LECTUREID,a.NAME,a.STATUS,a.TOTALCLASS,a.PRICE,a.TYPE,
 	a.SOLD,a.PASS,a.LASTCLASSTIME,a.REVIEWERID,x.USERNAME,x.USERID 
 	from XTEL_COURSEINFO a inner join XTEL_USERINFOTABLE x on a.LECTUREID=x.USERID
 	where a.LECTUREID=#{userID}
 	
</select>
<!-- 新增课程信息 -->
<insert id="insertCourseInfo" parameterType="courseInfoBean">

		INSERT INTO XTEL_COURSEINFO
		(
		COURSEID,
		LECTUREID,
		NAME,
		STATUS,
		TOTALCLASS,
		PRICE,
		TYPE,
		SOLD,
		PASS,
		LASTCLASSTIME,
		REVIEWERID,
		BRIEF,
		NUMBEROFEXPECTED
		) 
		VALUES(
		COURSEINFO_SQ.NEXTVAL,
		#{LecturerID},
		#{className},
		#{satus},
		#{classTime},
		#{classPrice},
		#{classtype},
		#{Sold},
		#{Pass},
		#{LastClassTime},
		#{ReviewerID},
		#{classinfo},
		#{calssNumber}
		)
</insert>
<!-- 已报名课程信息 -->
<select id="listRegisteredLessonPage" parameterType="int" resultType="map">
   	 select  a.COURSEID,a.LECTUREID,a.NAME,a.STATUS,a.TOTALCLASS,a.PRICE,a.TYPE,
 	a.SOLD,a.PASS,a.LASTCLASSTIME,a.REVIEWERID,x.USERNAME,x.USERID 
 	from XTEL_SignupList c left join  XTEL_COURSEINFO a on c.COURSEID=a.COURSEID 
 	inner join XTEL_USERINFOTABLE x on a.LECTUREID=x.USERID
 	where c.USERID=#{userID}
</select>
<!-- 添加我的排课记录 -->
<insert id="insertCourseArrangement" parameterType="map">
insert into XTEL_CourseArrangement(ID,COURSEID,TIME,LECTUREID,STATUS)
     values(COURSEARRANGEMENT_SQ.NEXTVAL,#{CpurseID},#{dateTime},#{userID},0) 

</insert>
<!-- 查询我的课程安排信息 -->
<select id="listCourseArrangeInfoPage" parameterType="int" resultType="map">

	 select  a.COURSEID,a.LECTUREID,a.NAME,a.TOTALCLASS,a.PRICE,a.TYPE,
 	a.SOLD,a.PASS,a.LASTCLASSTIME,a.REVIEWERID,c.ID,c.TIME,c.STATUS 
 	from XTEL_CourseArrangement c left join  XTEL_COURSEINFO a on c.COURSEID=a.COURSEID 
 
 	where c.LECTUREID=#{userID}
</select>
<!-- 查找我的课程安排详情 -->
<select id="getArrangeByid" resultType="map" parameterType="int">

SELECT TIME FROM  XTEL_CourseArrangement where ID=#{id}

</select>
<!-- 修改我的课程安排时间 -->
<update id="updateCourseArrangementTime" parameterType="map">

update XTEL_CourseArrangement set TIME=#{dateTime},STATUS=0 where ID=#{id}

</update>
<!-- 新增试卷信息 -->
<insert id="insertExpapersInfo" parameterType="map">

INSERT into XTEL_ExamPapers(ID,COURSEID,UPLOADERID,TOTALSCORE,PASSSCORE,NUMBEROFPARTICIPANTS,NUMBEROFPASS,URL,PAPERNAME,UPLOADTIME) 
VALUES(EXAMPAPERS_SQ.NEXTVAL,#{id},#{userID},#{TOTALSCORE},#{PASSSCORE},#{NUMBEROFPARTICIPANTS},
#{NUMBEROFPASS},#{expapersUrl},#{expapersNmae},#{uplodaTime})

</insert>

</mapper>